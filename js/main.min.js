(function(){let s=window.require("fs"),r=window.require("process"),n=r.platform,o=("win32"===n?r.env.APPDATA:"darwin"===n?r.env.HOME+"/Library/Preferences":process.env.HOME+"/.config")+"/BetterDiscord/",c={};if(s.existsSync(`${o}localStorage.json`))try{c=JSON.parse(s.readFileSync(`${o}localStorage.json`))}catch(m){console.log(m)}else if(s.existsSync("localStorage.json"))try{c=JSON.parse(s.readFileSync("localStorage.json"))}catch(m){console.log(m)}var d=c;d.setItem=function(m,u){d[m]=u,this.save()},d.getItem=function(m){return d[m]||null},d.save=function(){s.writeFileSync(`${o}/localStorage.json`,JSON.stringify(this),null,4)};var l=new Proxy(d,{set:function(m,u,h){d[u]=h,d.save()},get:function(m,u){return d[u]||null}});window.localStorage=l})(),(()=>{let s=document.createElement("div");s.className="bd-loaderv2",s.title="BetterDiscord is loading...",document.body.appendChild(s)})(),window.bdStorage={},window.bdStorage.get=function(s){return betterDiscordIPC.sendSync("synchronous-message",{arg:"storage",cmd:"get","var":s})},window.bdStorage.set=function(s,r){betterDiscordIPC.sendSync("synchronous-message",{arg:"storage",cmd:"set","var":s,data:r})},window.bdPluginStorage={},window.bdPluginStorage.get=function(s,r){return betterDiscordIPC.sendSync("synchronous-message",{arg:"pluginstorage",cmd:"get",pn:s,"var":r})},window.bdPluginStorage.set=function(s,r,n){betterDiscordIPC.sendSync("synchronous-message",{arg:"pluginstorage",cmd:"set",pn:s,"var":r,data:n})},betterDiscordIPC.on("asynchronous-reply",(s,r)=>{console.log(s),console.log(r)});var settingsPanel,emoteModule,utils,quickEmoteMenu,voiceMode,pluginModule,themeModule,dMode,jsVersion=1.792,supportedVersion="0.2.81",mainObserver,twitchEmoteUrlStart="https://static-cdn.jtvnw.net/emoticons/v1/",twitchEmoteUrlEnd="/1.0",ffzEmoteUrlStart="https://cdn.frankerfacez.com/emoticon/",ffzEmoteUrlEnd="/1",bttvEmoteUrlStart="https://cdn.betterttv.net/emote/",bttvEmoteUrlEnd="/1x",mainCore,settings={"Startup Error Modal":{id:"bda-gs-9",info:"Show a modal with plugin/theme errors on startup.",implemented:!0,hidden:!1,cat:"core"},"Show Toasts":{id:"bda-gs-10",info:"Shows a small notification for starting and stopping plugins & themes.",implemented:!0,hidden:!1,cat:"core"},"Save logs locally":{id:"bda-gs-0",info:"Saves chat logs locally",implemented:!1,hidden:!1,cat:"core"},"Public Servers":{id:"bda-gs-1",info:"Display public servers button",implemented:!1,hidden:!1,cat:"core"},"Minimal Mode":{id:"bda-gs-2",info:"Hide elements and reduce the size of elements.",implemented:!0,hidden:!1,cat:"core"},"Voice Mode":{id:"bda-gs-4",info:"Only show voice chat",implemented:!0,hidden:!1,cat:"core"},"Hide Channels":{id:"bda-gs-3",info:"Hide channels in minimal mode",implemented:!0,hidden:!1,cat:"core"},"Dark Mode":{id:"bda-gs-5",info:"Make certain elements dark by default(wip)",implemented:!0,hidden:!1,cat:"core"},"Override Default Emotes":{id:"bda-es-5",info:"Override default emotes",implemented:!1,hidden:!1,cat:"core"},"Voice Disconnect":{id:"bda-dc-0",info:"Disconnect from voice server when closing Discord",implemented:!0,hidden:!1,cat:"core"},"Custom css live update":{id:"bda-css-0",info:"",implemented:!0,hidden:!0,cat:"core"},"Custom css auto udpate":{id:"bda-css-1",info:"",implemented:!0,hidden:!0,cat:"core"},"24 Hour Timestamps":{id:"bda-gs-6",info:"Replace 12hr timestamps with proper ones",implemented:!0,hidden:!1,cat:"core"},"Coloured Text":{id:"bda-gs-7",info:"Make text colour the same as role colour",implemented:!0,hidden:!1,cat:"core"},"BetterDiscord Blue":{id:"bda-gs-b",info:"Replace Discord blue with BD Blue",implemented:!0,hidden:!1,cat:"core"},"Developer Mode":{id:"bda-gs-8",info:"Developer Mode",implemented:!0,hidden:!1,cat:"core"},"Twitch Emotes":{id:"bda-es-7",info:"Show Twitch emotes",implemented:!0,hidden:!1,cat:"emote"},"FrankerFaceZ Emotes":{id:"bda-es-1",info:"Show FrankerFaceZ Emotes",implemented:!0,hidden:!1,cat:"emote"},"BetterTTV Emotes":{id:"bda-es-2",info:"Show BetterTTV Emotes",implemented:!0,hidden:!1,cat:"emote"},"Emote Menu":{id:"bda-es-0",info:"Show Twitch/Favourite emotes in emote menu",implemented:!0,hidden:!1,cat:"emote"},"Emoji Menu":{id:"bda-es-9",info:"Show Discord emoji menu",implemented:!0,hidden:!1,cat:"emote"},"Emote Autocomplete":{id:"bda-es-3",info:"Autocomplete emote commands",implemented:!1,hidden:!1,cat:"emote"},"Emote Auto Capitalization":{id:"bda-es-4",info:"Autocapitalize emote commands",implemented:!0,hidden:!1,cat:"emote"},"Show Names":{id:"bda-es-6",info:"Show emote names on hover",implemented:!0,hidden:!1,cat:"emote"},"Show emote modifiers":{id:"bda-es-8",info:"Enable emote mods",implemented:!0,hidden:!1,cat:"emote"}},defaultCookie={version:jsVersion,"bda-gs-0":!1,"bda-gs-1":!1,"bda-gs-2":!1,"bda-gs-3":!1,"bda-gs-4":!1,"bda-gs-5":!0,"bda-gs-6":!1,"bda-gs-7":!1,"bda-gs-8":!1,"bda-gs-9":!0,"bda-gs-10":!0,"bda-es-0":!0,"bda-es-1":!0,"bda-es-2":!0,"bda-es-3":!1,"bda-es-4":!1,"bda-es-5":!0,"bda-es-6":!0,"bda-es-7":!0,"bda-gs-b":!0,"bda-es-8":!0,"bda-jd":!0,"bda-dc-0":!1,"bda-css-0":!1,"bda-css-1":!1,"bda-es-9":!0},settingsCookie={},bdpluginErrors,bdthemeErrors;function Core(){}Core.prototype.init=function(){function s(){console.log(new Date().getTime()+" Defer"),0<document.querySelectorAll(".guilds .guild").length?(console.log(new Date().getTime()+" Defer Loaded"),r.injectExternals(),!bdpluginErrors&&(bdpluginErrors=[]),!bdthemeErrors&&(bdthemeErrors=[]),pluginModule=new PluginModule,pluginModule.loadPlugins(),themeModule=new ThemeModule,themeModule.loadThemes(),settingsPanel=new V2_SettingsPanel,settingsPanel.updateSettings(),quickEmoteMenu.init(!1),window.addEventListener("beforeunload",function(){settingsCookie["bda-dc-0"]&&document.querySelector(".btn.btn-disconnect").click()}),emoteModule.autoCapitalize(),settingsCookie.version<jsVersion&&(settingsCookie.version=jsVersion,r.saveSettings()),$("head").append("<style>.CodeMirror{ min-width:100%; }</style>"),$("head").append("<style id=\"bdemotemenustyle\"></style>"),document.getElementsByClassName("bd-loaderv2")[0].remove(),settingsCookie["bda-gs-9"]&&r.showStartupErrors(),r.initObserver()):setTimeout(s,100)}var r=this,n="undefined"==typeof version?bdVersion:version;return n<supportedVersion?void this.alert("Not Supported","BetterDiscord v"+n+"(your version) is not supported by the latest js("+jsVersion+").<br><br> Please download the latest version from <a href='https://betterdiscord.net' target='_blank'>BetterDiscord.net</a>"):void(utils=new Utils,utils.getHash(),emoteModule=new EmoteModule,quickEmoteMenu=new QuickEmoteMenu,voiceMode=new VoiceMode,dMode=new devMode,emoteModule.init(),this.initSettings(),$(document).ready(function(){setTimeout(s,1e3)}))},Core.prototype.injectExternals=function(){utils.injectJs("https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.0/codemirror.min.js"),utils.injectJs("https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.0/mode/css/css.min.js"),utils.injectJs("https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.0/addon/scroll/simplescrollbars.min.js"),utils.injectCss("https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.0/addon/scroll/simplescrollbars.min.css"),utils.injectCss("https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.0/theme/material.min.css"),utils.injectJs("https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.4.2/Sortable.min.js")},Core.prototype.initSettings=function(){if(void 0==$.cookie("better-discord"))settingsCookie=defaultCookie,this.saveSettings();else for(var s in this.loadSettings(),$("<style id=\"customcss\">").html(atob(window.bdStorage.get("bdcustomcss"))).appendTo(document.head),defaultCookie)void 0==settingsCookie[s]&&(settingsCookie[s]=defaultCookie[s],this.saveSettings())},Core.prototype.saveSettings=function(){$.cookie("better-discord",JSON.stringify(settingsCookie),{expires:365,path:"/"})},Core.prototype.loadSettings=function(){settingsCookie=JSON.parse($.cookie("better-discord"))},Core.prototype.initObserver=function(){let s=this;mainObserver=new MutationObserver(function(r){r.forEach(function(n){if("undefined"!=typeof pluginModule&&pluginModule.rawObserver(n),n.removedNodes.length&&n.removedNodes[0]instanceof Element){let c=n.removedNodes[0];(c.classList.contains("activityFeed-HeiGwL")||"friends"===c.id)&&pluginModule.channelSwitch()}if(n.addedNodes.length&&n.addedNodes[0]instanceof Element){let o=n.addedNodes[0];o.classList.contains("layer")&&(o.querySelector(".guild-settings-base-section")&&o.setAttribute("layer-id","server-settings"),o.querySelector(".socialLinks-1oZoF3")&&(o.setAttribute("layer-id","user-settings"),!o.querySelector("#bd-settings-sidebar")&&settingsPanel.renderSidebar())),o.classList.contains("popout")&&o.getElementsByClassName("emoji-picker").length&&quickEmoteMenu.obsCallback(o),(o.classList.contains("activityFeed-HeiGwL")||"friends"===o.id)&&pluginModule.channelSwitch(),(o.classList.contains("messages-wrapper")||o.querySelector(".messages-wrapper"))&&(s.inject24Hour(o),s.injectColoredText(o),pluginModule.channelSwitch()),o.classList.contains("message-group")&&!o.querySelector(".message-sending")&&(s.inject24Hour(o),s.injectColoredText(o),o.parentElement&&o.parentElement.children&&o==o.parentElement.children[o.parentElement.children.length-1]&&pluginModule.newMessage()),o.classList.contains("message")&&!o.classList.contains("message-sending")&&(s.injectColoredText(o.parentElement.parentElement),pluginModule.newMessage()),emoteModule.obsCallback(n)}})}),mainObserver.observe(document,{childList:!0,subtree:!0})},Core.prototype.inject24Hour=function(s){settingsCookie["bda-gs-6"]&&s.querySelectorAll(".timestamp").forEach(r=>{if(!r.getAttribute("data-24")){let n=r.innerText||r.textContent,o=/([^0-9]*)([0-9]?[0-9]:[0-9][0-9])([^0-9]*)/.exec(n);if(null!=o&&!(4>o.length)){let c=o[2].split(":"),d=parseInt(c[0]),l=c[1],m=o[3].toLowerCase();m.includes("am")&&12==d?d-=12:m.includes("pm")&&2>d&&(d+=12),d=("0"+d).slice(-2),r.innerText=o[1]+d+":"+l+o[3],r.setAttribute("data-24",o[2])}}})},Core.prototype.remove24Hour=function(s){s.querySelectorAll(".timestamp").forEach(r=>{if(r.getAttribute("data-24")){let n=r.getAttribute("data-24");r.removeAttribute("data-24");let o=r.innerText||r.textContent,c=/([^0-9]*)([0-9]?[0-9]:[0-9][0-9])([^0-9]*)/.exec(o);null==c||4>c.length||(r.innerText=c[1]+n+c[3])}})},Core.prototype.injectColoredText=function(s){settingsCookie["bda-gs-7"]&&s.querySelectorAll(".user-name").forEach(r=>{let n=r.style.color;"rgb(255, 255, 255)"===n||r.closest(".message-group").querySelectorAll(".markup").forEach(o=>{o.getAttribute("data-color")||(o.setAttribute("data-color",!0),o.style.setProperty("color",n))})})},Core.prototype.removeColoredText=function(s){s.querySelectorAll(".user-name").forEach(r=>{r.closest(".message-group").querySelectorAll(".markup").forEach(n=>{n.getAttribute("data-color")&&(n.removeAttribute("data-color"),n.style.setProperty("color",""))})})},Core.prototype.alert=function(s,r){let n=$(`<div class="bd-modal-wrapper theme-dark">
<div class="bd-backdrop backdrop-2ohBEd"></div>
<div class="bd-modal modal-2LIEKY">
    <div class="bd-modal-inner inner-1_1f7b">
        <div class="header header-3sp3cE">
            <div class="title">${s}</div>
        </div>
        <div class="bd-modal-body">
            <div class="scroller-wrap fade">
                <div class="scroller">
                    ${r}
                </div>
            </div>
        </div>
        <div class="footer footer-1PYmcw">
            <button type="button">Okay</button>
        </div>
    </div>
</div>
</div>`);n.find(".footer button").on("click",()=>{n.addClass("closing"),setTimeout(()=>{n.remove()},300)}),n.find(".bd-backdrop").on("click",()=>{n.addClass("closing"),setTimeout(()=>{n.remove()},300)}),n.appendTo("#app-mount")},Core.prototype.showStartupErrors=function(){function s(o){let c=$(`<div class="errors">`);for(let d of o){let l=$(`<div class="error">
            <div class="table-column column-name">${d.name?d.name:d.file}</div>
            <div class="table-column column-reason">${d.reason}</div>
            <div class="table-column column-error"><a class="error-link" href="">${d.error?d.error.message:""}</a></div>
        </div>`);c.append(l),d.error&&l.find("a").on("click",m=>{m.preventDefault(),utils.err(`Error details for ${d.name?d.name:d.file}.`,d.error)})}return c}if(bdpluginErrors&&bdthemeErrors&&(bdpluginErrors.length||bdthemeErrors.length)){let r=$(`<div class="bd-modal-wrapper theme-dark">
<div class="bd-backdrop backdrop-2ohBEd"></div>
<div class="bd-modal bd-startup-modal modal-2LIEKY">
    <div class="bd-modal-inner inner-1_1f7b">
        <div class="header header-3sp3cE"><div class="title">Startup Errors</div></div>
        <div class="bd-modal-body">
            <div class="tab-bar-container">
                <div class="tab-bar TOP">
                    <div class="tab-bar-item">Plugins</div>
                    <div class="tab-bar-item">Themes</div>
                </div>
            </div>
            <div class="table-header">
                <div class="table-column column-name">Name</div>
                <div class="table-column column-reason">Reason</div>
                <div class="table-column column-error">Error</div>
            </div>
            <div class="scroller-wrap fade">
                <div class="scroller">

                </div>
            </div>
        </div>
        <div class="footer footer-1PYmcw">
            <button type="button">Okay</button>
        </div>
    </div>
</div>
</div>`),n=[s(bdpluginErrors),s(bdthemeErrors)];r.find(".tab-bar-item").on("click",o=>{o.preventDefault(),r.find(".tab-bar-item").removeClass("selected"),$(o.target).addClass("selected"),r.find(".scroller").empty().append(n[$(o.target).index()])}),r.find(".footer button").on("click",()=>{r.addClass("closing"),setTimeout(()=>{r.remove()},300)}),r.find(".bd-backdrop").on("click",()=>{r.addClass("closing"),setTimeout(()=>{r.remove()},300)}),r.appendTo("#app-mount"),r.find(".tab-bar-item")[0].click()}},Core.prototype.showToast=function(s,r={}){if(!document.querySelector(".bd-toasts")){let l=document.createElement("div");l.classList.add("bd-toasts");let m=document.querySelector(".chat form, #friends, .noChannel-2EQ0a9, .activityFeed-HeiGwL");l.style.setProperty("left",m?m.getBoundingClientRect().left+"px":"0px"),l.style.setProperty("width",m?m.offsetWidth+"px":"100%"),l.style.setProperty("bottom",(document.querySelector(".chat form")?document.querySelector(".chat form").offsetHeight:80)+"px"),document.querySelector(".app").appendChild(l)}const{type:n="",icon:o=!0,timeout:c=3e3}=r;let d=document.createElement("div");d.classList.add("bd-toast"),n&&d.classList.add("toast-"+n),n&&o&&d.classList.add("icon"),d.innerText=s,document.querySelector(".bd-toasts").appendChild(d),setTimeout(()=>{d.classList.add("closing"),setTimeout(()=>{d.remove(),document.querySelectorAll(".bd-toasts .bd-toast").length||document.querySelector(".bd-toasts").remove()},300)},c)};var emotesFfz={},emotesBTTV={},emotesBTTV2={},emotesTwitch={emote:{id:0}},subEmotesTwitch={};function EmoteModule(){}EmoteModule.prototype.init=function(){},EmoteModule.prototype.getBlacklist=function(){$.getJSON("https://cdn.rawgit.com/Jiiks/betterDiscordApp/"+_hash+"/data/emotefilter.json",function(s){bemotes=s.blacklist})},EmoteModule.prototype.obsCallback=function(s){for(var o,r=this,n=0;n<s.addedNodes.length;++n)if(o=s.addedNodes.item(n),o){var c=r.getNodes(o);for(var d in c)if(c.hasOwnProperty(d)){var l=c[d].parentElement;l&&l.classList.contains("edited")?r.injectEmote(l):r.injectEmote(c[d])}}},EmoteModule.prototype.getNodes=function(s){for(var r,n=[],o=document.createTreeWalker(s,NodeFilter.SHOW_TEXT,null,!1);r=o.nextNode();)n.push(r);return n};var bemotes=[];EmoteModule.prototype.injectEmote=function(s){function r(){var c=o.contents();c.each(function(d){if(void 0!=c[d]){var l=c[d].nodeValue;if(null!=l&&8!=c[d].nodeType){c.splice(d,1);var m=l.split(/([^\s]+)([\s]|$)/g).filter(function(y){return y}),u=0,h=!1,g=null;if(m.forEach(function(y,E,k){-1<y.indexOf("[!s]")&&(y=y.replace("[!s]",""),o.data("spoilered",!1),o.addClass("spoiler"));var S="",N=!1,T=y;if(-1<y.indexOf(":")){var D=y.split(":");""!=D[0]&&""!=D[1]&&(-1<["flip","spin","pulse","spin2","spin3","1spin","2spin","3spin","tr","bl","br","shake","shake2","shake3","flap"].indexOf(D[1])&&(T=D[0],S=settingsCookie["bda-es-8"]?"emote"+D[1]:""),"bttv"==D[1]&&(T=D[0],N=!0))}if(-1==$.inArray(T,bemotes)){if(settingsCookie["bda-es-7"]&&emotesTwitch.hasOwnProperty(T)&&4<=T.length){null!=g&&(c.splice(d+u++,0,document.createTextNode(g)),g=null);let j=twitchEmoteUrlStart+emotesTwitch[T].id+twitchEmoteUrlEnd;return c.splice(d+u++,0,n.createEmoteElement(T,j,S)),void(h=!0)}if(settingsCookie["bda-es-7"]&&subEmotesTwitch.hasOwnProperty(T)&&4<=T.length){null!=g&&(c.splice(d+u++,0,document.createTextNode(g)),g=null);let j=twitchEmoteUrlStart+subEmotesTwitch[T]+twitchEmoteUrlEnd;return c.splice(d+u++,0,n.createEmoteElement(T,j,S)),void(h=!0)}if(settingsCookie["bda-es-2"]&&emotesBTTV.hasOwnProperty(T)&&4<=T.length){null!=g&&(c.splice(d+u++,0,document.createTextNode(g)),g=null);let j=emotesBTTV[T];return c.splice(d+u++,0,n.createEmoteElement(T,j,S)),void(h=!0)}if(settingsCookie["bda-es-1"]&&(!N||!emotesBTTV2.hasOwnProperty(T))&&emotesFfz.hasOwnProperty(T)&&4<=T.length){null!=g&&(c.splice(d+u++,0,document.createTextNode(g)),g=null);let j=ffzEmoteUrlStart+emotesFfz[T]+ffzEmoteUrlEnd;return c.splice(d+u++,0,n.createEmoteElement(T,j,S)),void(h=!0)}if(settingsCookie["bda-es-2"]&&emotesBTTV2.hasOwnProperty(T)&&4<=T.length){null!=g&&(c.splice(d+u++,0,document.createTextNode(g)),g=null);let j=bttvEmoteUrlStart+emotesBTTV2[T]+bttvEmoteUrlEnd;return N&&emotesFfz.hasOwnProperty(T)&&(T+=":bttv"),c.splice(d+u++,0,n.createEmoteElement(T,j,S)),void(h=!0)}}null==g?g=y:g+=""+y,E===k.length-1&&c.splice(d+u,0,document.createTextNode(g))}),h){var b=o.outerHeight();o.html(c);var f=$(".scroller.messages").first();f.scrollTop(f.scrollTop()+(o.outerHeight()-b))}}}})}var n=this;if(s.parentElement){var o=s.parentElement;(o.classList.contains("markup")||o.classList.contains("message-content"))&&(o=$(o),r(),o.children().hasClass("edited")&&setTimeout(r,250))}},EmoteModule.prototype.createEmoteElement=function(s,r,n){var o=Math.round(s.length/4),c=s.substr(0,o)+"\uFDD9"+s.substr(o,o)+"\uFDD9"+s.substr(2*o,o)+"\uFDD9"+s.substr(3*o);return $.parseHTML(("<span class=\"emotewrapper\"><img draggable=\"false\" style=\"max-height:32px;\" class=\"emote "+n+"\" alt=\""+c+"\" src=\""+r+"\"/><input onclick='quickEmoteMenu.favorite(\""+c+"\", \""+r+"\");' class=\"fav\" title=\"Favorite!\" type=\"button\"></span>").replace(/﷙/g,""))[0]},EmoteModule.prototype.autoCapitalize=function(){var s=this;$("body").delegate($(".channelTextArea-1HTP3C textarea:first"),"keyup change paste",function(){if(settingsCookie["bda-es-4"]){var r=$(".channelTextArea-1HTP3C textarea:first").val();if(void 0!=r){var n=r.split(" ").pop();if(3<n.length){if("danSgame"==n)return;var o=s.capitalize(n.toLowerCase());null!==o&&void 0!==o&&utils.insertText(utils.getTextArea()[0],r.replace(n,o))}}}})},EmoteModule.prototype.capitalize=function(s){var r=emotesTwitch;for(var n in r)if(r.hasOwnProperty(n)&&s==(n+"").toLowerCase())return n};function QuickEmoteMenu(){}QuickEmoteMenu.prototype.init=function(){$(document).on("mousedown",function(l){"rmenu"!=l.target.id&&$("#rmenu").remove()}),this.favoriteEmotes={};var s=window.bdStorage.get("bdfavemotes");""!==s&&null!==s&&(this.favoriteEmotes=JSON.parse(atob(s)));var r="";r+="<div id=\"bda-qem\">",r+="    <button class=\"active\" id=\"bda-qem-twitch\" onclick='quickEmoteMenu.switchHandler(this); return false;'>Twitch</button>",r+="    <button id=\"bda-qem-favourite\" onclick='quickEmoteMenu.switchHandler(this); return false;'>Favourite</button>",r+="    <button id=\"bda-qem-emojis\" onclick='quickEmoteMenu.switchHandler(this); return false;'>Emojis</buttond>",r+="</div>",this.qmeHeader=r;var n="";for(let l in n+="<div id=\"bda-qem-twitch-container\">",n+="    <div class=\"scroller-wrap fade\">",n+="        <div class=\"scroller\">",n+="            <div class=\"emote-menu-inner\">",emotesTwitch)if(emotesTwitch.hasOwnProperty(l)){var o=emotesTwitch[l].id;n+="<div class=\"emote-container\">",n+="    <img class=\"emote-icon\" id=\""+l+"\" alt=\"\" src=\"https://static-cdn.jtvnw.net/emoticons/v1/"+o+"/1.0\" title=\""+l+"\">",n+="    </img>",n+="</div>"}n+="            </div>",n+="        </div>",n+="    </div>",n+="</div>",this.teContainer=n;var c="";for(let l in c+="<div id=\"bda-qem-favourite-container\">",c+="    <div class=\"scroller-wrap fade\">",c+="        <div class=\"scroller\">",c+="            <div class=\"emote-menu-inner\">",this.favoriteEmotes){var d=this.favoriteEmotes[l];c+="<div class=\"emote-container\">",c+="    <img class=\"emote-icon\" alt=\"\" src=\""+d+"\" title=\""+l+"\" oncontextmenu='quickEmoteMenu.favContext(event, this);'>",c+="    </img>",c+="</div>"}c+="            </div>",c+="        </div>",c+="    </div>",c+="</div>",this.faContainer=c},QuickEmoteMenu.prototype.favContext=function(s,r){s.stopPropagation();var n=$("<div>",{id:"rmenu","data-emoteid":$(r).prop("title"),text:"Remove",class:"context-menu theme-dark"});return n.css({top:s.pageY-$("#bda-qem-favourite-container").offset().top,left:s.pageX-$("#bda-qem-favourite-container").offset().left}),$(r).parent().append(n),n.on("click",function(o){return o.preventDefault(),o.stopPropagation(),$(this).remove(),delete quickEmoteMenu.favoriteEmotes[$(this).data("emoteid")],quickEmoteMenu.updateFavorites(),!1}),!1},QuickEmoteMenu.prototype.switchHandler=function(s){this.switchQem($(s).attr("id"))},QuickEmoteMenu.prototype.switchQem=function(s){var r=$("#bda-qem-twitch"),n=$("#bda-qem-favourite"),o=$("#bda-qem-emojis");r.removeClass("active"),n.removeClass("active"),o.removeClass("active"),$(".emoji-picker").hide(),$("#bda-qem-favourite-container").hide(),$("#bda-qem-twitch-container").hide();"bda-qem-twitch"===s?(r.addClass("active"),$("#bda-qem-twitch-container").show()):"bda-qem-favourite"===s?(n.addClass("active"),$("#bda-qem-favourite-container").show()):"bda-qem-emojis"===s?(o.addClass("active"),$(".emoji-picker").show(),$(".emoji-picker .search-bar-inner input").focus()):void 0;this.lastTab=s;var c=$(".emote-icon");c.off(),c.on("click",function(){var d=$(this).attr("title"),l=utils.getTextArea();utils.insertText(l[0]," "==l.val().slice(-1)?l.val()+d:l.val()+" "+d)})},QuickEmoteMenu.prototype.obsCallback=function(s){var r=$(s);settingsCookie["bda-es-9"]?r.removeClass("bda-qme-hidden"):r.addClass("bda-qme-hidden");settingsCookie["bda-es-0"]&&(r.prepend(this.qmeHeader),r.append(this.teContainer),r.append(this.faContainer),this.lastTab==void 0&&(this.lastTab="bda-qem-favourite"),this.switchQem(this.lastTab))},QuickEmoteMenu.prototype.favorite=function(s,r){this.favoriteEmotes.hasOwnProperty(s)||(this.favoriteEmotes[s]=r),this.updateFavorites()},QuickEmoteMenu.prototype.updateFavorites=function(){var s="";for(var r in s+="<div id=\"bda-qem-favourite-container\">",s+="    <div class=\"scroller-wrap fade\">",s+="        <div class=\"scroller\">",s+="            <div class=\"emote-menu-inner\">",this.favoriteEmotes){var n=this.favoriteEmotes[r];s+="<div class=\"emote-container\">",s+="    <img class=\"emote-icon\" alt=\"\" src=\""+n+"\" title=\""+r+"\" oncontextmenu=\"quickEmoteMenu.favContext(event, this);\">",s+="    </img>",s+="</div>"}s+="            </div>",s+="        </div>",s+="    </div>",s+="</div>",this.faContainer=s,$("#bda-qem-favourite-container").replaceWith(s),window.bdStorage.set("bdfavemotes",btoa(JSON.stringify(this.favoriteEmotes)))};var _hash;function Utils(){}Utils.prototype.getTextArea=function(){return $(".channelTextArea-1HTP3C textarea")},Utils.prototype.insertText=function(s,r){s.focus(),s.selectionStart=0,s.selectionEnd=s.value.length,document.execCommand("insertText",!1,r)},Utils.prototype.jqDefer=function(s){window.jQuery?s():setTimeout(function(){this.jqDefer(s)},100)},Utils.prototype.getHash=function(){$.getJSON("https://api.github.com/repos/Jiiks/BetterDiscordApp/commits/master",function(s){_hash=s.sha,emoteModule.getBlacklist()})},Utils.prototype.loadHtml=function(s,r){var n=$("<div/>",{class:"bd-container"}).appendTo("body");s="//cdn.rawgit.com/Jiiks/BetterDiscordApp/"+_hash+"/html/"+s+".html",n.load(s,r())},Utils.prototype.injectJs=function(s){$("<script/>",{type:"text/javascript",src:s}).appendTo($("body"))},Utils.prototype.injectCss=function(s){$("<link/>",{type:"text/css",rel:"stylesheet",href:s}).appendTo($("head"))},Utils.prototype.escapeID=function(s){return s.replace(/^[^a-z]+|[^\w-]+/gi,"")},Utils.prototype.log=function(s){console.log("%c[BetterDiscord] %c"+s+"","color: #3a71c1; font-weight: 700;","")},Utils.prototype.err=function(s,r){console.log("%c[BetterDiscord] %c"+s+"","color: red; font-weight: 700;",""),r&&(console.groupCollapsed("%cError: "+r.message,"color: red;"),console.error(r.stack),console.groupEnd())};function VoiceMode(){}VoiceMode.prototype.obsCallback=function(){var s=this;settingsCookie["bda-gs-4"]&&(s.disable(),setTimeout(function(){s.enable()},300))},VoiceMode.prototype.enable=function(){$(".scroller.guild-channels ul").first().css("display","none"),$(".scroller.guild-channels header").first().css("display","none"),$(".app.flex-vertical").first().css("overflow","hidden"),$(".chat.flex-vertical.flex-spacer").first().css("visibility","hidden").css("min-width","0px"),$(".flex-vertical.channels-wrap").first().css("flex-grow","100000"),$(".guild-header .btn.btn-hamburger").first().css("visibility","hidden")},VoiceMode.prototype.disable=function(){$(".scroller.guild-channels ul").first().css("display",""),$(".scroller.guild-channels header").first().css("display",""),$(".app.flex-vertical").first().css("overflow",""),$(".chat.flex-vertical.flex-spacer").first().css("visibility","").css("min-width",""),$(".flex-vertical.channels-wrap").first().css("flex-grow",""),$(".guild-header .btn.btn-hamburger").first().css("visibility","")};var pluginCookie={};function PluginModule(){}PluginModule.prototype.loadPlugins=function(){this.loadPluginData();for(var s=Object.keys(bdplugins),r=0;r<s.length;r++){var n,o;try{n=bdplugins[s[r]].plugin,o=n.getName(),n.load()}catch(c){pluginCookie[o]=!1,utils.err("Plugin "+o+" could not be loaded.",c),bdpluginErrors.push({name:o,file:bdplugins[s[r]].filename,reason:"load() could not be fired.",error:{message:c.message,stack:c.stack}});continue}if(pluginCookie[o]||(pluginCookie[o]=!1),pluginCookie[o])try{n.start(),settingsCookie["bda-gs-10"]&&mainCore.showToast(`${n.getName()} v${n.getVersion()} has started.`)}catch(c){pluginCookie[o]=!1,utils.err("Plugin "+o+" could not be started.",c),bdpluginErrors.push({name:o,file:bdplugins[s[r]].filename,reason:"start() could not be fired.",error:{message:c.message,stack:c.stack}})}}this.savePluginData()},PluginModule.prototype.startPlugin=function(s){try{bdplugins[s].plugin.start(),settingsCookie["bda-gs-10"]&&mainCore.showToast(`${bdplugins[s].plugin.getName()} v${bdplugins[s].plugin.getVersion()} has started.`)}catch(r){pluginCookie[s]=!1,this.savePluginData(),utils.err("Plugin "+name+" could not be started.",r)}},PluginModule.prototype.stopPlugin=function(s){try{bdplugins[s].plugin.stop(),settingsCookie["bda-gs-10"]&&mainCore.showToast(`${bdplugins[s].plugin.getName()} v${bdplugins[s].plugin.getVersion()} has stopped.`)}catch(r){utils.err("Plugin "+name+" could not be stopped.",r)}},PluginModule.prototype.enablePlugin=function(s){pluginCookie[s]=!0,this.savePluginData(),this.startPlugin(s)},PluginModule.prototype.disablePlugin=function(s){pluginCookie[s]=!1,this.savePluginData(),this.stopPlugin(s)},PluginModule.prototype.togglePlugin=function(s){pluginCookie[s]?this.disablePlugin(s):this.enablePlugin(s)},PluginModule.prototype.loadPluginData=function(){var s=$.cookie("bd-plugins");s!=void 0&&(pluginCookie=JSON.parse($.cookie("bd-plugins")))},PluginModule.prototype.savePluginData=function(){$.cookie("bd-plugins",JSON.stringify(pluginCookie),{expires:365,path:"/"})},PluginModule.prototype.newMessage=function(){for(var n,s=Object.keys(bdplugins),r=0;r<s.length;r++)if(n=bdplugins[s[r]].plugin,pluginCookie[n.getName()]&&"function"==typeof n.onMessage)try{n.onMessage()}catch(u){utils.err("Unable to fire onMessage for "+n.getName()+".",u)}},PluginModule.prototype.channelSwitch=function(){for(var n,s=Object.keys(bdplugins),r=0;r<s.length;r++)if(n=bdplugins[s[r]].plugin,pluginCookie[n.getName()]&&"function"==typeof n.onSwitch)try{n.onSwitch()}catch(h){utils.err("Unable to fire onSwitch for "+n.getName()+".",h)}},PluginModule.prototype.rawObserver=function(s){for(var o,r=Object.keys(bdplugins),n=0;n<r.length;n++)if(o=bdplugins[r[n]].plugin,pluginCookie[o.getName()]&&"function"==typeof o.observer)try{o.observer(s)}catch(g){utils.err("Unable to fire observer for "+o.getName()+".",g)}};var themeCookie={};function ThemeModule(){}ThemeModule.prototype.loadThemes=function(){this.loadThemeData();for(var n,s=Object.keys(bdthemes),r=0;r<s.length;r++)n=bdthemes[s[r]].name,themeCookie[n]||(themeCookie[n]=!1),themeCookie[n]&&$("head").append($("<style>",{id:utils.escapeID(n),html:unescape(bdthemes[n].css)}))},ThemeModule.prototype.enableTheme=function(s){themeCookie[s]=!0,this.saveThemeData(),$("head").append(`<style id="${utils.escapeID(bdthemes[s].name)}">${unescape(bdthemes[s].css)}</style>`),settingsCookie["bda-gs-10"]&&mainCore.showToast(`${bdthemes[s].name} v${bdthemes[s].version} has been applied.`)},ThemeModule.prototype.disableTheme=function(s){themeCookie[s]=!1,this.saveThemeData(),$(`#${utils.escapeID(bdthemes[s].name)}`).remove(),settingsCookie["bda-gs-10"]&&mainCore.showToast(`${bdthemes[s].name} v${bdthemes[s].version} has been removed.`)},ThemeModule.prototype.toggleTheme=function(s){themeCookie[s]?this.disableTheme(s):this.enableTheme(s)},ThemeModule.prototype.loadThemeData=function(){var s=$.cookie("bd-themes");s!=void 0&&(themeCookie=JSON.parse($.cookie("bd-themes")))},ThemeModule.prototype.saveThemeData=function(){$.cookie("bd-themes",JSON.stringify(themeCookie),{expires:365,path:"/"})};function BdApi(){}BdApi.injectCSS=function(s,r){$("head").append($("<style>",{id:utils.escapeID(s),html:r}))},BdApi.clearCSS=function(s){$("#"+utils.escapeID(s)).remove()},BdApi.linkJS=function(s,r){$("head").append($("<script>",{id:utils.escapeID(s),src:r,type:"text/javascript"}))},BdApi.unlinkJS=function(s){$("#"+utils.escapeID(s)).remove()},BdApi.getPlugin=function(s){return bdplugins.hasOwnProperty(s)?bdplugins[s].plugin:null},BdApi.getIpc=function(){return betterDiscordIPC},BdApi.getCore=function(){return mainCore},BdApi.alert=function(s,r){mainCore.alert(s,r)},BdApi.showToast=function(s,r={}){mainCore.showToast(s,r)};function devMode(){}devMode.prototype.enable=function(){var s=this;this.disable(),$(window).on("keydown.bdDevmode",function(r){if(119===r.which){console.log("%c[%cDevMode%c] %cBreak/Resume","color: red;","color: #303030; font-weight:700;","color:red;","");debugger}}),$(document).on("contextmenu.bdDevmode",function(r){var o=[];$(r.toElement).parents().addBack().not("html").each(function(){var c="";this.classList&&this.classList.length&&(c+="."+Array.prototype.join.call(this.classList,"."),o.push(c))}),s.lastSelector=o.join(" ").trim(),setImmediate(function(){var c=$(".context-menu");0>=c.length&&(c=$("<div class=\"context-menu bd-context-menu\"></div>"),c.addClass($(".app").hasClass("theme-dark")?"theme-dark":"theme-light"),c.appendTo(".app"),c.css("top",r.clientY),c.css("left",r.clientX),$(document).on("click.bdDevModeCtx",()=>{c.remove(),$(document).off(".bdDevModeCtx")}),$(document).on("contextmenu.bdDevModeCtx",()=>{c.remove(),$(document).off(".bdDevModeCtx")}),$(document).on("keyup.bdDevModeCtx",m=>{27===m.keyCode&&(c.remove(),$(document).off(".bdDevModeCtx"))}));var d=$("<div/>",{class:"item-group"}),l=$("<div/>",{class:"item",click:function(){var m=$("<textarea/>",{text:s.lastSelector}).appendTo("body");m.select(),document.execCommand("copy"),m.remove(),c.hide()}}).append($("<span/>",{text:"Copy Selector"}));d.append(l),c.append(d),c.css("top","-="+d.outerHeight())}),r.stopPropagation()})},devMode.prototype.disable=function(){$(window).off("keydown.bdDevmode"),$(document).off("contextmenu.bdDevmode"),$(document).off("contextmenu.bdDevModeCtx")},window.bdtemp={editorDetached:!1};class V2{constructor(){this.internal={react:require("react"),"react-dom":require("react-dom")}}get reactComponent(){return this.internal.react.Component}get react(){return this.internal.react}get reactDom(){return this.internal["react-dom"]}parseSettings(s){return Object.keys(settings).reduce((r,n)=>{let o=settings[n];return o.cat===s&&o.implemented&&!o.hidden&&(o.text=n,r.push(o)),r},[])}}window.BDV2=new V2;class V2C_SettingsPanel extends BDV2.reactComponent{constructor(s){super(s)}render(){let{settings:s}=this.props;return BDV2.react.createElement("div",{className:"content-column default"},BDV2.react.createElement(V2Components.SettingsTitle,{text:this.props.title}),s.map(r=>{return BDV2.react.createElement(V2Components.Switch,{id:r.id,key:r.id,data:r,checked:settingsCookie[r.id],onChange:(n,o)=>{this.props.onChange(n,o)}})}))}}class V2C_Switch extends BDV2.reactComponent{constructor(s){super(s),this.setInitialState(),this.onChange=this.onChange.bind(this)}setInitialState(){this.state={checked:this.props.checked}}render(){let{text:s,info:r}=this.props.data,{checked:n}=this.state;return BDV2.react.createElement("div",{className:"ui-flex flex-vertical flex-justify-start flex-align-stretch flex-nowrap ui-switch-item"},BDV2.react.createElement("div",{className:"ui-flex flex-horizontal flex-justify-start flex-align-stretch flex-nowrap"},BDV2.react.createElement("h3",{className:"ui-form-title h3 margin-reset margin-reset ui-flex-child"},s),BDV2.react.createElement("label",{className:"ui-switch-wrapper ui-flex-child",style:{flex:"0 0 auto"}},BDV2.react.createElement("input",{className:"ui-switch-checkbox",type:"checkbox",checked:n,onChange:o=>this.onChange(o)}),BDV2.react.createElement("div",{className:`ui-switch ${n?"checked":""}`}))),BDV2.react.createElement("div",{className:"ui-form-text style-description margin-top-4",style:{flex:"1 1 auto"}},r))}onChange(){this.props.onChange(this.props.id,!this.state.checked),this.setState({checked:!this.state.checked})}}class V2C_Scroller extends BDV2.reactComponent{constructor(s){super(s)}render(){let s=`scroller-wrap${this.props.fade?" fade":""} ${this.props.dark?" dark":""}`,{children:r}=this.props;return BDV2.react.createElement("div",{key:"scrollerwrap",className:s},BDV2.react.createElement("div",{key:"scroller",ref:"scroller",className:"scroller"},r))}}class V2C_TabBarItem extends BDV2.reactComponent{constructor(s){super(s),this.setInitialState(),this.onClick=this.onClick.bind(this)}setInitialState(){this.state={selected:this.props.selected||!1}}render(){return BDV2.react.createElement("div",{className:`ui-tab-bar-item${this.props.selected?" selected":""}`,onClick:this.onClick},this.props.text)}onClick(){this.props.onClick&&this.props.onClick(this.props.id)}}class V2C_TabBarSeparator extends BDV2.reactComponent{constructor(s){super(s)}render(){return BDV2.react.createElement("div",{className:"ui-tab-bar-separator margin-top-8 margin-bottom-8"})}}class V2C_TabBarHeader extends BDV2.reactComponent{constructor(s){super(s)}render(){return BDV2.react.createElement("div",{className:"ui-tab-bar-header"},this.props.text)}}class V2C_SideBar extends BDV2.reactComponent{constructor(s){super(s);let r=this;const n=$("[class*=side] > [class*=selected]");n.length&&(r.scn=n.attr("class"));const o=$("[class*=side] > [class*=notSelected]");o.length&&(r.nscn=o.attr("class")),$("[class*=side] > [class*=item]").on("click",()=>{r.setState({selected:null})}),r.setInitialState(),r.onClick=r.onClick.bind(r)}setInitialState(){let s=this;s.state={selected:null,items:s.props.items};let r=s.props.items.find(n=>{return n.selected});r&&(s.state.selected=r.id)}render(){let s=this,{headerText:r}=s.props,{items:n,selected:o}=s.state;return BDV2.react.createElement("div",null,BDV2.react.createElement(V2Components.TabBar.Separator,null),BDV2.react.createElement(V2Components.TabBar.Header,{text:r}),n.map(c=>{let{id:d,text:l}=c;return BDV2.react.createElement(V2Components.TabBar.Item,{key:d,selected:o===d,text:l,id:d,onClick:s.onClick})}))}onClick(s){let r=this;const n=$("[class*=side] > [class*=selected]");n.length&&(n.off("click.bdsb").on("click.bsb",o=>{$(o.target).attr("class",r.scn)}),n.attr("class",r.nscn)),r.setState({selected:null}),r.setState({selected:s}),r.props.onClick&&r.props.onClick(s)}}class V2C_XSvg extends BDV2.reactComponent{constructor(s){super(s)}render(){return BDV2.react.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 12 12",style:{width:"18px",height:"18px"}},BDV2.react.createElement("g",{className:"background",fill:"none",fillRule:"evenodd"},BDV2.react.createElement("path",{d:"M0 0h12v12H0"}),BDV2.react.createElement("path",{className:"fill",fill:"#dcddde",d:"M9.5 3.205L8.795 2.5 6 5.295 3.205 2.5l-.705.705L5.295 6 2.5 8.795l.705.705L6 6.705 8.795 9.5l.705-.705L6.705 6"})))}}class V2C_Tools extends BDV2.reactComponent{constructor(s){super(s),this.onClick=this.onClick.bind(this)}render(){return BDV2.react.createElement("div",{className:"tools"},BDV2.react.createElement("div",{className:"btn-close",onClick:this.onClick},BDV2.react.createElement(V2Components.XSvg,null)),BDV2.react.createElement("div",{className:"esc-text"},"ESC"))}onClick(){this.props.onClick&&this.props.onClick(),$(".btn-close").first().click()}}class V2C_SettingsTitle extends BDV2.reactComponent{constructor(s){super(s)}render(){return BDV2.react.createElement("h2",{className:"ui-form-title h2 margin-reset margin-bottom-20"},this.props.text)}}class V2C_Checkbox extends BDV2.reactComponent{constructor(s){super(s),this.onClick=this.onClick.bind(this),this.setInitialState()}setInitialState(){this.state={checked:this.props.checked||!1}}render(){return BDV2.react.createElement("li",null,BDV2.react.createElement("div",{className:"checkbox",onClick:this.onClick},BDV2.react.createElement("div",{className:"checkbox-inner"},BDV2.react.createElement("input",{checked:this.state.checked,onChange:()=>{},type:"checkbox"}),BDV2.react.createElement("span",null)),BDV2.react.createElement("span",null,this.props.text)))}onClick(){this.props.onChange(this.props.id,!this.state.checked),this.setState({checked:!this.state.checked})}}class V2C_CssEditorDetached extends BDV2.reactComponent{constructor(s){super(s);let r=this;r.onClick=r.onClick.bind(r),r.updateCss=r.updateCss.bind(r),r.saveCss=r.saveCss.bind(r),r.onChange=r.onChange.bind(r)}componentDidMount(){let s=this;$("#app-mount").addClass("bd-detached-editor"),s.editor=CodeMirror.fromTextArea(s.refs.editor,s.options),s.editor.on("change",()=>{settingsCookie["bda-css-0"]&&s.updateCss()}),window.bdtemp.editorDetached=!0}componentWillUnmount(){$("#app-mount").removeClass("bd-detached-editor"),window.bdtemp.editorDetached=!1}get options(){return{lineNumbers:!0,mode:"css",indentUnit:4,theme:"material",scrollbarStyle:"simple"}}get css(){let s=window.bdStorage.get("bdcustomcss"),r="";return s&&""!==s&&(r=atob(s)),r}get root(){let s=$("#bd-customcss-detach-container");return s.length?s[0]:this.injectRoot()?this.detachedRoot:null}injectRoot(){return!!$(".app").length&&($("<div/>",{id:"bd-customcss-detach-container"}).insertAfter($(".app")),!0)}render(){let s=this;return BDV2.react.createElement("div",{className:"bd-detached-css-editor",id:"bd-customcss-detach-editor"},BDV2.react.createElement("div",{id:"bd-customcss-innerpane"},BDV2.react.createElement("textarea",{onChange:()=>{},value:s.css,ref:"editor",id:"bd-customcss-ta"}),BDV2.react.createElement("div",{id:"bd-customcss-attach-controls"},BDV2.react.createElement("ul",{className:"checkbox-group"},BDV2.react.createElement(V2Components.Checkbox,{id:"live-update",text:"Live Update",onChange:s.onChange,checked:settingsCookie["bda-css-0"]})),BDV2.react.createElement("div",{id:"bd-customcss-detach-controls-button"},BDV2.react.createElement("button",{style:{borderRadius:"3px 0 0 3px",borderRight:"1px solid #3f4146"},className:"btn btn-primary",onClick:()=>{s.onClick("update")}},"Update"),BDV2.react.createElement("button",{style:{borderRadius:"0",borderLeft:"1px solid #2d2d2d",borderRight:"1px solid #2d2d2d"},className:"btn btn-primary",onClick:()=>{s.onClick("save")}},"Save"),BDV2.react.createElement("button",{style:{borderRadius:"0 3px 3px 0",borderLeft:"1px solid #3f4146"},className:"btn btn-primary",onClick:()=>{s.onClick("attach")}},"Attach"),BDV2.react.createElement("span",{style:{fontSize:"10px",marginLeft:"5px"}},"Unsaved changes are lost on attach")))))}onChange(s,r){"live-update"===s?(settingsCookie["bda-css-0"]=r,mainCore.saveSettings()):void 0}onClick(s){let r=this;"attach"===s?($("#editor-detached").length&&r.props.attach(),BDV2.reactDom.unmountComponentAtNode(r.root),r.root.remove()):"update"===s?r.updateCss():"save"===s?r.saveCss():void 0}updateCss(){let s=this;0==$("#customcss").length&&$("head").append("<style id=\"customcss\"></style>"),$("#customcss").html(s.editor.getValue())}saveCss(){let s=this;window.bdStorage.set("bdcustomcss",btoa(s.editor.getValue()))}}class V2C_CssEditor extends BDV2.reactComponent{constructor(s){super(s);let r=this;r.setInitialState(),r.attach=r.attach.bind(r),r.detachedEditor=BDV2.react.createElement(V2C_CssEditorDetached,{attach:r.attach}),r.onClick=r.onClick.bind(r),r.updateCss=r.updateCss.bind(r),r.saveCss=r.saveCss.bind(r),r.detach=r.detach.bind(r),r.codeMirror=r.codeMirror.bind(r)}setInitialState(){this.state={detached:this.props.detached||window.bdtemp.editorDetached}}componentDidMount(){let s=this;s.codeMirror()}componentDidUpdate(s,r){let n=this;r.detached&&!n.state.detached&&(BDV2.reactDom.unmountComponentAtNode(n.detachedRoot),n.codeMirror())}codeMirror(){let s=this;s.state.detached||(s.editor=CodeMirror.fromTextArea(s.refs.editor,s.options),s.editor.on("change",()=>{settingsCookie["bda-css-0"]&&s.updateCss()}))}get options(){return{lineNumbers:!0,mode:"css",indentUnit:4,theme:"material",scrollbarStyle:"simple"}}get css(){let s=window.bdStorage.get("bdcustomcss"),r="";return s&&""!==s&&(r=atob(s)),r}render(){let s=this,{detached:r}=s.state;return BDV2.react.createElement("div",{className:"content-column default",style:{padding:"60px 40px 0px"}},r&&BDV2.react.createElement("div",{id:"editor-detached"},BDV2.react.createElement(V2Components.SettingsTitle,{text:"Custom CSS Editor"}),BDV2.react.createElement("h3",null,"Editor Detached"),BDV2.react.createElement("button",{className:"btn btn-primary",onClick:()=>{s.attach()}},"Attach")),!r&&BDV2.react.createElement("div",null,BDV2.react.createElement(V2Components.SettingsTitle,{text:"Custom CSS Editor"}),BDV2.react.createElement("textarea",{ref:"editor",value:s.css,onChange:()=>{}}),BDV2.react.createElement("div",{id:"bd-customcss-attach-controls"},BDV2.react.createElement("ul",{className:"checkbox-group"},BDV2.react.createElement(V2Components.Checkbox,{id:"live-update",text:"Live Update",onChange:this.onChange,checked:settingsCookie["bda-css-0"]})),BDV2.react.createElement("div",{id:"bd-customcss-detach-controls-button"},BDV2.react.createElement("button",{style:{borderRadius:"3px 0 0 3px",borderRight:"1px solid #3f4146"},className:"btn btn-primary",onClick:()=>{s.onClick("update")}},"Update"),BDV2.react.createElement("button",{style:{borderRadius:"0",borderLeft:"1px solid #2d2d2d",borderRight:"1px solid #2d2d2d"},className:"btn btn-primary",onClick:()=>{s.onClick("save")}},"Save"),BDV2.react.createElement("button",{style:{borderRadius:"0 3px 3px 0",borderLeft:"1px solid #3f4146"},className:"btn btn-primary",onClick:()=>{s.onClick("detach")}},"Detach"),BDV2.react.createElement("span",{style:{fontSize:"10px",marginLeft:"5px"}},"Unsaved changes are lost on detach")))))}onClick(s){let r=this;"update"===s?r.updateCss():"save"===s?r.saveCss():"detach"===s?r.detach():void 0}onChange(s,r){"live-update"===s?(settingsCookie["bda-css-0"]=r,mainCore.saveSettings()):void 0}updateCss(){let s=this;0==$("#customcss").length&&$("head").append("<style id=\"customcss\"></style>"),$("#customcss").html(s.editor.getValue())}saveCss(){let s=this;window.bdStorage.set("bdcustomcss",btoa(s.editor.getValue()))}detach(){let s=this;s.setState({detached:!0});let r=s.detachedRoot;return r?void BDV2.reactDom.render(s.detachedEditor,r):void console.log("FAILED TO INJECT ROOT: .app")}get detachedRoot(){let s=$("#bd-customcss-detach-container");return s.length?s[0]:this.injectDetachedRoot()?this.detachedRoot:null}injectDetachedRoot(){return!!$(".app").length&&($("<div/>",{id:"bd-customcss-detach-container"}).insertAfter($(".app")),!0)}attach(){let s=this;s.setState({detached:!1})}}class V2C_List extends BDV2.reactComponent{constructor(s){super(s)}render(){return BDV2.react.createElement("ul",{className:this.props.className},this.props.children)}}class V2C_ContentColumn extends BDV2.reactComponent{constructor(s){super(s)}render(){return BDV2.react.createElement("div",{className:"content-column default"},BDV2.react.createElement("h2",{className:"ui-form-title h2 margin-reset margin-bottom-20"},this.props.title),this.props.children)}}class V2C_PluginCard extends BDV2.reactComponent{constructor(s){super(s);let r=this;"function"==typeof r.props.plugin.getSettingsPanel&&(r.settingsPanel=r.props.plugin.getSettingsPanel()),r.onChange=r.onChange.bind(r),r.showSettings=r.showSettings.bind(r),r.setInitialState()}setInitialState(){this.state={checked:pluginCookie[this.props.plugin.getName()],settings:!1}}componentDidUpdate(){this.state.settings&&"object"==typeof this.settingsPanel&&this.refs.settingspanel.appendChild(this.settingsPanel)}render(){let s=this,{plugin:r}=this.props,n=r.getName(),o=r.getAuthor(),c=r.getDescription(),d=r.getVersion(),l=bdplugins[n].website,m=bdplugins[n].source,{settingsPanel:u}=this;return this.state.settings?BDV2.react.createElement("li",{className:"settings-open ui-switch-item"},BDV2.react.createElement("div",{style:{float:"right",cursor:"pointer"},onClick:()=>{this.refs.settingspanel.innerHTML="",s.setState({settings:!1})}},BDV2.react.createElement(V2Components.XSvg,null)),"object"==typeof u&&BDV2.react.createElement("div",{id:`plugin-settings-${n}`,className:"plugin-settings",ref:"settingspanel"}),"object"!=typeof u&&BDV2.react.createElement("div",{id:`plugin-settings-${n}`,className:"plugin-settings",ref:"settingspanel",dangerouslySetInnerHTML:{__html:this.settingsPanel}})):BDV2.react.createElement("li",{"data-name":n,"data-version":d,className:"settings-closed ui-switch-item"},BDV2.react.createElement("div",{className:"bda-header"},BDV2.react.createElement("span",{className:"bda-header-title"},BDV2.react.createElement("span",{className:"bda-name"},n)," v",BDV2.react.createElement("span",{className:"bda-version"},d)," by ",BDV2.react.createElement("span",{className:"bda-author"},o)),BDV2.react.createElement("label",{className:"ui-switch-wrapper ui-flex-child",style:{flex:"0 0 auto"}},BDV2.react.createElement("input",{checked:this.state.checked,onChange:this.onChange,className:"ui-switch-checkbox",type:"checkbox"}),BDV2.react.createElement("div",{className:this.state.checked?"ui-switch checked":"ui-switch"}))),BDV2.react.createElement("div",{className:"bda-description-wrap scroller-wrap fade"},BDV2.react.createElement("div",{className:"bda-description scroller"},c)),BDV2.react.createElement("div",{className:"bda-footer"},BDV2.react.createElement("span",{className:"bda-links"},l&&BDV2.react.createElement("a",{className:"bda-link",href:l,target:"_blank"},"Website"),l&&m&&" | ",m&&BDV2.react.createElement("a",{className:"bda-link",href:m,target:"_blank"},"Source")),this.settingsPanel&&BDV2.react.createElement("button",{onClick:this.showSettings,className:"bda-settings-button",disabled:!this.state.checked},"Settings")))}onChange(){this.setState({checked:!this.state.checked}),pluginModule.togglePlugin(this.props.plugin.getName())}showSettings(){if(this.settingsPanel){this.setState({settings:!0});let s=$(BDV2.reactDom.findDOMNode(this)),r=s.parents(".scroller");r.animate({scrollTop:s.offset().top-r.offset().top+r.scrollTop()-30},1e3)}}}class V2C_ThemeCard extends BDV2.reactComponent{constructor(s){super(s),this.setInitialState(),this.onChange=this.onChange.bind(this)}setInitialState(){this.state={checked:themeCookie[this.props.theme.name]}}render(){let{theme:s}=this.props,r=s.name,n=s.description,o=s.version,c=s.author,d=bdthemes[r].website,l=bdthemes[r].source;return BDV2.react.createElement("li",{"data-name":r,"data-version":o,className:"settings-closed ui-switch-item"},BDV2.react.createElement("div",{className:"bda-header"},BDV2.react.createElement("span",{className:"bda-header-title"},BDV2.react.createElement("span",{className:"bda-name"},r)," v",BDV2.react.createElement("span",{className:"bda-version"},o)," by ",BDV2.react.createElement("span",{className:"bda-author"},c)),BDV2.react.createElement("label",{className:"ui-switch-wrapper ui-flex-child",style:{flex:"0 0 auto"}},BDV2.react.createElement("input",{checked:this.state.checked,onChange:this.onChange,className:"ui-switch-checkbox",type:"checkbox"}),BDV2.react.createElement("div",{className:this.state.checked?"ui-switch checked":"ui-switch"}))),BDV2.react.createElement("div",{className:"bda-description-wrap scroller-wrap fade"},BDV2.react.createElement("div",{className:"bda-description scroller"},n)),BDV2.react.createElement("div",{className:"bda-footer"},BDV2.react.createElement("span",{className:"bda-links"},d&&BDV2.react.createElement("a",{className:"bda-link",href:d,target:"_blank"},"Website"),d&&l&&" | ",l&&BDV2.react.createElement("a",{className:"bda-link",href:l,target:"_blank"},"Source"))))}onChange(){this.setState({checked:!this.state.checked}),themeModule.toggleTheme(this.props.theme.name)}}class V2Cs_TabBar{static get Item(){return V2C_TabBarItem}static get Header(){return V2C_TabBarHeader}static get Separator(){return V2C_TabBarSeparator}}class V2C_Layer extends BDV2.reactComponent{constructor(s){super(s)}componentDidMount(){$(window).on(`keyup.${this.props.id}`,s=>{27===s.which&&BDV2.reactDom.unmountComponentAtNode(this.refs.root.parentNode)})}componentWillUnmount(){$(window).off(`keyup.${this.props.id}`),$(`#${this.props.rootId}`).remove()}render(){return BDV2.react.createElement("div",{className:"layer",id:this.props.id,ref:"root"},this.props.children)}}class V2C_SidebarView extends BDV2.reactComponent{constructor(s){super(s)}render(){let{sidebar:s,content:r}=this.props.children;return BDV2.react.createElement("div",{className:"ui-standard-sidebar-view"},BDV2.react.createElement("div",{className:"sidebar-region"},BDV2.react.createElement(V2Components.Scroller,{key:"sidebarScroller",ref:"sidebarScroller",fade:s.fade||!0,dark:s.dark||!0,children:s.component})),BDV2.react.createElement("div",{className:"content-region"},BDV2.react.createElement(V2Components.Scroller,{key:"contentScroller",ref:"contentScroller",fade:r.fade||!0,dark:r.dark||!0,children:r.component})))}}class V2C_ServerCard extends BDV2.reactComponent{constructor(s){super(s)}render(){let{server:s}=this.props;return BDV2.react.createElement("div",{className:`ui-card ui-card-primary bd-server-card${s.pinned?" bd-server-card-pinned":""}`,style:{marginTop:"5px"}},BDV2.react.createElement("div",{className:"ui-flex horizontal",style:{display:"flex",flexFlow:"row nowrap",justifyContent:"flex-start",alignItems:"stretch",flex:"1 1 auto"}},BDV2.react.createElement("div",{className:"ui-flex-child",style:{flex:"0 1 auto",padding:"5px"}},BDV2.react.createElement("div",{className:"bd-pubs-server-icon",style:{width:"100px",height:"100px",backgroundSize:"cover",backgroundImage:`url(${s.icon})`}})),BDV2.react.createElement("div",{className:"ui-flex-child",style:{flex:"1 1 auto",padding:"5px"}},BDV2.react.createElement("div",{className:"ui-flex horizontal"},BDV2.react.createElement("div",{className:"ui-form-item",style:{flex:"1 1 auto"}},BDV2.react.createElement("h5",{className:"ui-form-title h5 margin-reset"},s.name)),BDV2.react.createElement("div",{className:"ui-form-item"},BDV2.react.createElement("h5",{className:"ui-form-title h5 margin-reset"},s.online,"/",s.members," Members"))),BDV2.react.createElement("div",{className:"ui-flex horizontal"},BDV2.react.createElement("div",{className:"scroller-wrap fade dark",style:{minHeight:"60px",maxHeight:"60px",borderTop:"1px solid #3f4146",borderBottom:"1px solid #3f4146",paddingTop:"5px"}},BDV2.react.createElement("div",{className:"scroller"},BDV2.react.createElement("div",{style:{fontSize:"13px",color:"#b9bbbe"}},s.description)))),BDV2.react.createElement("div",{className:"ui-flex horizontal"},BDV2.react.createElement("div",{className:"ui-flex-child bd-server-tags",style:{flex:"1 1 auto"}},s.categories.join(", ")),s.joined&&BDV2.react.createElement("button",{type:"button",className:"ui-button filled brand small grow disabled",style:{minHeight:"12px",marginTop:"4px",backgroundColor:"#3ac15c"}},BDV2.react.createElement("div",{className:"ui-button-contents"},"Joined")),s.error&&BDV2.react.createElement("button",{type:"button",className:"ui-button filled brand small grow disabled",style:{minHeight:"12px",marginTop:"4px",backgroundColor:"#c13a3a"}},BDV2.react.createElement("div",{className:"ui-button-contents"},"Error")),!s.error&&!s.joined&&BDV2.react.createElement("button",{type:"button",className:"ui-button filled brand small grow",style:{minHeight:"12px",marginTop:"4px"},onClick:()=>{this.join(s.identifier)}},BDV2.react.createElement("div",{className:"ui-button-contents"},"Join"))))))}join(){let s=this;s.props.join(s.props.server)}}class V2Components{static get SettingsPanel(){return V2C_SettingsPanel}static get Switch(){return V2C_Switch}static get Scroller(){return V2C_Scroller}static get TabBar(){return V2Cs_TabBar}static get SideBar(){return V2C_SideBar}static get Tools(){return V2C_Tools}static get SettingsTitle(){return V2C_SettingsTitle}static get CssEditor(){return V2C_CssEditor}static get Checkbox(){return V2C_Checkbox}static get List(){return V2C_List}static get PluginCard(){return V2C_PluginCard}static get ThemeCard(){return V2C_ThemeCard}static get ContentColumn(){return V2C_ContentColumn}static get XSvg(){return V2C_XSvg}static get Layer(){return V2C_Layer}static get SidebarView(){return V2C_SidebarView}static get ServerCard(){return V2C_ServerCard}}class V2_SettingsPanel_Sidebar{constructor(s){this.onClick=s}get items(){return[{text:"Core",id:"core"},{text:"Emotes",id:"emotes"},{text:"Custom CSS",id:"customcss"},{text:"Plugins",id:"plugins"},{text:"Themes",id:"themes"}]}get component(){return BDV2.react.createElement("span",null,BDV2.react.createElement(V2Components.SideBar,{onClick:this.onClick,headerText:"BetterDiscord",items:this.items}),BDV2.react.createElement("span",{style:{fontSize:"12px",fontWeight:"600",color:"#72767d",padding:"6px 10px"}},`v${bdVersion}:${jsVersion} by `,BDV2.react.createElement("a",{href:"https://github.com/Jiiks/",target:"_blank"},"Jiiks")))}get root(){let s=$("#bd-settings-sidebar");return s.length?s[0]:this.injectRoot()?this.root:null}injectRoot(){let s=$("[class*=side] > [class*=item]:not([class*=Danger])").last();return!!s.length&&($("<span/>",{id:"bd-settings-sidebar"}).insertBefore(s.prev()),!0)}render(){let s=this.root;return s?void BDV2.reactDom.render(this.component,s):void console.log("FAILED TO LOCATE ROOT: [class*=side] > [class*=item]:not([class*=Danger])")}}class V2_SettingsPanel{constructor(){let s=this;s.sideBarOnClick=s.sideBarOnClick.bind(s),s.onChange=s.onChange.bind(s),s.updateSettings=this.updateSettings.bind(s),s.sidebar=new V2_SettingsPanel_Sidebar(s.sideBarOnClick)}get root(){let s=$("#bd-settingspane-container");return s.length?s[0]:this.injectRoot()?this.root:null}injectRoot(){return!!$(".layer .ui-standard-sidebar-view").length&&($(".layer .ui-standard-sidebar-view").append($("<div/>",{class:"content-region",id:"bd-settingspane-container"})),!0)}get coreSettings(){return this.getSettings("core")}get emoteSettings(){return this.getSettings("emote")}getSettings(s){return Object.keys(settings).reduce((r,n)=>{let o=settings[n];return o.cat===s&&o.implemented&&!o.hidden&&(o.text=n,r.push(o)),r},[])}sideBarOnClick(s){let r=this;$(".content-region").first().hide(),$(r.root).show();"core"===s?r.renderCoreSettings():"emotes"===s?r.renderEmoteSettings():"customcss"===s?r.renderCustomCssEditor():"plugins"===s?r.renderPluginPane():"themes"===s?r.renderThemePane():void 0}onClick(){}onChange(s,r){settingsCookie[s]=r,this.updateSettings()}updateSettings(){let s=settingsCookie;if(s["bda-es-0"]?$("#twitchcord-button-container").show():$("#twitchcord-button-container").hide(),s["bda-gs-b"]?$("body").addClass("bd-blue"):$("body").removeClass("bd-blue"),s["bda-gs-2"]?$("body").addClass("bd-minimal"):$("body").removeClass("bd-minimal"),s["bda-gs-3"]?$("body").addClass("bd-minimal-chan"):$("body").removeClass("bd-minimal-chan"),s["bda-gs-1"]?$("#bd-pub-li").show():$("#bd-pub-li").hide(),s["bda-gs-4"]?voiceMode.enable():voiceMode.disable(),s["bda-gs-5"]?$("#app-mount").addClass("bda-dark"):$("#app-mount").removeClass("bda-dark"),document.querySelector(".messages")){let n=document.querySelector(".messages");s["bda-gs-6"]?mainCore.inject24Hour(n):mainCore.remove24Hour(n),s["bda-gs-7"]&&document.querySelector(".messages")?mainCore.injectColoredText(n):mainCore.removeColoredText(n)}if(s["bda-es-6"]){var r=$("<div class='tipsy tipsy-se' style='display: block; top: 82px; left: 1630.5px; visibility: visible; opacity: 0.8;'><div class='tipsy-inner'></div></div>");$(document).on("mouseover",".emote",function(){var n=$(this),o=n.offset(),c=n.attr("alt");r.find(".tipsy-inner").text(c),$(".app").append($(r));var d=o.left+n.outerWidth()/2;r.css("left",d-r.outerWidth()/2),r.css("top",o.top-r.outerHeight())}),$(document).on("mouseleave",".emote",function(){$(".tipsy").remove()})}else $(document).off("mouseover",".emote");s["bda-gs-8"]?dMode.enable():dMode.disable(),mainCore.saveSettings()}renderSidebar(){let s=this;$("[class*=side] > [class*=item]").off("click.v2settingspanel").on("click.v2settingspanel",()=>{BDV2.reactDom.unmountComponentAtNode(s.root),$(s.root).hide(),$(".content-region").first().show()}),s.sidebar.render()}get coreComponent(){return BDV2.react.createElement(V2Components.Scroller,{fade:!0,dark:!0,children:[BDV2.react.createElement(V2Components.SettingsPanel,{key:"cspanel",title:"Core Settings",onChange:this.onChange,settings:this.coreSettings}),BDV2.react.createElement(V2Components.Tools,{key:"tools"})]})}get emoteComponent(){return BDV2.react.createElement(V2Components.Scroller,{fade:!0,dark:!0,children:[BDV2.react.createElement(V2Components.SettingsPanel,{key:"espanel",title:"Emote Settings",onChange:this.onChange,settings:this.emoteSettings}),BDV2.react.createElement(V2Components.Tools,{key:"tools"})]})}get customCssComponent(){return BDV2.react.createElement(V2Components.Scroller,{fade:!0,dark:!0,children:[BDV2.react.createElement(V2Components.CssEditor,{key:"csseditor"}),BDV2.react.createElement(V2Components.Tools,{key:"tools"})]})}get pluginsComponent(){let s=Object.keys(bdplugins).reduce((c,d)=>{return c.push(BDV2.react.createElement(V2Components.PluginCard,{key:d,plugin:bdplugins[d].plugin})),c},[]),r=BDV2.react.createElement(V2Components.List,{key:"plugin-list",className:"bda-slist",children:s}),n=BDV2.react.createElement("button",{key:"folder-button",className:"bd-pfbtn",onClick:()=>{betterDiscordIPC.send("asynchronous-message",{arg:"opendir",path:"plugindir"})}},"Open Plugin Folder"),o=BDV2.react.createElement(V2Components.ContentColumn,{key:"pcolumn",title:"Plugins",children:[n,r]});return BDV2.react.createElement(V2Components.Scroller,{fade:!0,dark:!0,children:[o,BDV2.react.createElement(V2Components.Tools,{key:"tools"})]})}get themesComponent(){let s=Object.keys(bdthemes).reduce((c,d)=>{return c.push(BDV2.react.createElement(V2Components.ThemeCard,{key:d,theme:bdthemes[d]})),c},[]),r=BDV2.react.createElement(V2Components.List,{key:"theme-list",className:"bda-slist",children:s}),n=BDV2.react.createElement("button",{key:"folder-button",className:"bd-pfbtn",onClick:()=>{betterDiscordIPC.send("asynchronous-message",{arg:"opendir",path:"themedir"})}},"Open Theme Folder"),o=BDV2.react.createElement(V2Components.ContentColumn,{key:"tcolumn",title:"Themes",children:[n,r]});return BDV2.react.createElement(V2Components.Scroller,{fade:!0,dark:!0,children:[o,BDV2.react.createElement(V2Components.Tools,{key:"tools"})]})}renderCoreSettings(){let s=this.root;return s?void BDV2.reactDom.render(this.coreComponent,s):void console.log("FAILED TO LOCATE ROOT: .layer .ui-standard-sidebar-view")}renderEmoteSettings(){let s=this.root;return s?void BDV2.reactDom.render(this.emoteComponent,s):void console.log("FAILED TO LOCATE ROOT: .layer .ui-standard-sidebar-view")}renderCustomCssEditor(){let s=this.root;return s?void BDV2.reactDom.render(this.customCssComponent,s):void console.log("FAILED TO LOCATE ROOT: .layer .ui-standard-sidebar-view")}renderPluginPane(){let s=this.root;return s?void BDV2.reactDom.render(this.pluginsComponent,s):void console.log("FAILED TO LOCATE ROOT: .layer .ui-standard-sidebar-view")}renderThemePane(){let s=this.root;return s?void BDV2.reactDom.render(this.themesComponent,s):void console.log("FAILED TO LOCATE ROOT: .layer .ui-standard-sidebar-view")}}